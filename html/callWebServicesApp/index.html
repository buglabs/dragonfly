<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<!-- ########### INSERT PAGE TITLE HERE ########## -->
		<title>
			Tutorial:Call a Web Service
		</title>
		<!-- ########### /INSERT PAGE TITLE HERE ########## -->

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="STYLESHEET" href="../../book.css" charset="ISO-8859-1" type="text/css" />
	</head>
	<body>
		<div id="content">
			<a id="top" name="top"></a>

			<!-- firstHeading -->
			<h1 id="firstHeading" class="firstHeading">
				<!-- ########### INSERT H1 TITLE HERE ########## -->
				Tutorial:Call a Web Service
				<!-- ########### /INSERT H1 TITLE HERE ########## -->
			</h1>
			<!-- /firstHeading -->
			<!-- bodyContent -->
			<div id="bodyContent">

				<!-- ########### START OF INSERTED CONTENT ########## -->
									<!-- bodytext -->
								<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>

				<ul>
				<li class="toclevel-1 tocsection-1"><a href="#Create_the_project"><span class="tocnumber">1</span> <span class="toctext">Create the project</span></a></li>
				<li class="toclevel-1 tocsection-2"><a href="#LCD_Helloworld_code_snippets"><span class="tocnumber">2</span> <span class="toctext">LCD Helloworld code snippets</span></a></li>
				<li class="toclevel-1 tocsection-3"><a href="#Run_it.21"><span class="tocnumber">3</span> <span class="toctext">Run it!</span></a></li>
				<li class="toclevel-1 tocsection-4"><a href="#Concepts"><span class="tocnumber">4</span> <span class="toctext">Concepts</span></a></li>

				</ul>
				</td></tr></table><script>if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
				<p>Create a basic application for BUG using a Web service that displays a message on the system output console.
				</p>
				<h2> <span class="mw-headline" id="Create_the_project"> Create the project </span></h2>
				<ol>
				
					
					<li> If necessary, switch perspectives in Eclipse to the Dragonfly perspective. (Hint: Go to Window &gt; Open Perspective &gt; Other)
				</li><li> In the toolbar, select the 'Launch Virtual BUG' icon <img alt="Virtual bug.gif" src="../images/virtual_bug.gif" width="16" height="16" />

				</li><li> Go to File &gt; New &gt; Project<br />Or, click the <b>New BUG Project</b> icon <img alt="bugProject.gif" src="../images/bugProject.gif" width="16" height="16" /> in the toolbar.
				</li><li> In the New Project wizard, click the arrow to open the Dragonfly node.
				</li><li> Select <b>BUG Application</b>, then click <b>Next</b>.

				</li><li> In the New BUG Project window:<br />In the Name field, type: <tt>LCD Helloworld</tt><br />In the Target section, leave Virtual BUG selected.
				</li><li> Click <b>Find BUG services</b>.
				</li><li> In the Find BUG services list, mark the checkbox next to <tt>com.bugalbs.status.IStatusBarProvider</tt>, then click <b>Finish</b>.
				</li><li> In left-side Project Explorer view, expand the <tt>lcdhelloworld.servicetracker</tt> node.

				</li><li> Double-click to edit the LCD_HelloworldServiceTracker.java file.
				</li><li> Find the <tt>doStart()</tt> method.  This method gets called by Concierge when all our requested services are available.  In this instance, we can expect <tt>IStatusBarProvider</tt> to be available.
				</li><li> In <tt>doStart()</tt> add the code in Snippet A below.
				</li><li> In <tt>doStop()</tt> add the code in Snippet B.

				</li><li> Add the fields in Snippet C up towards after <code>public class LCD_HelloworldServiceTracker extends AbstractServiceTracker {</code>
				</li><li> At the very top, with the other import statements, add Snippet D.
				</li></ol>
				<h2> <span class="mw-headline" id="LCD_Helloworld_code_snippets"> LCD Helloworld code snippets </span></h2>
				<p><big>Snippet A</big>
				</p>
				<pre>statusBar = (IStatusBarProvider) this.getService(IStatusBarProvider.class);
				key = statusBar.acquireRegion("Hello".length());

				if (key&nbsp;!= null) {
				    statusBar.write(key, "Hello");
				}
				</pre>

				<p><br />
				<big>Snippet B</big>
				</p>
				<pre>if (key&nbsp;!= null) {
				    statusBar.releaseRegion(key);
				}
				</pre>
				<p><br />
				<big>Snippet C</big>
				</p>
				<pre>private IStatusBarProvider statusBar;
				private String key;
				</pre>
				<p><big>Snippet D</big>
				</p>
				<pre>import com.buglabs.status.IStatusBarProvider;

				</pre>
				<p><big>Example after adding Snippets</big>
				</p>
				<pre>
				*	Generated by Dragonfly SDK
				 *
				 */
				package lcd_helloworld.servicetracker;

				import org.osgi.framework.BundleContext;
				import com.buglabs.application.AbstractServiceTracker;
				import com.buglabs.status.*;

				 /**
				 *	Service tracker for the BugApp Bundle;
				 *
				 */
				public class LCD_HelloworldServiceTracker extends AbstractServiceTracker {	

					private IStatusBarProvider statusBar; 
					private String key;

					public LCD_HelloworldServiceTracker(BundleContext context) {
						super(context);
					}

					/**
					 * Determines if the application can start.
					 */
					public boolean canStart() {
						return super.canStart();
					}

					/**
					 * If canStart returns true
				     * this method is called to start the application.
				     * Place your fun logic here. 
					 */
					public void doStart() {
						System.out.println(&quot;LCD_HelloworldServiceTracker: start&quot;);
						statusBar = (IStatusBarProvider) this.getService(IStatusBarProvider.class);
							key = statusBar.acquireRegion(&quot;Hello&quot;.length());
							if (key&nbsp;!= null) { 
								statusBar.write(key, &quot;Hello&quot;);
							} 
					}

					/**
					 * Called when a service that this application depends is unregistered.
					 */
					public void doStop() {
						System.out.println(&quot;LCD_HelloworldServiceTracker: stop&quot;);
						if (key&nbsp;!= null) { statusBar.releaseRegion(key);
						} 
					}

					/**
					 * Allows the user to set the service dependencies by
				     * adding them to services list returned by getServices().
				     * i.e.nl getServices().add(MyService.class.getName());
					 */
					public void initServices() {
						getServices().add(&quot;com.buglabs.status.IStatusBarProvider&quot;);
					}

				}

				</pre>
				<h2> <span class="mw-headline" id="Run_it.21"> Run it! </span></h2>
				<p>Stop the Virtual BUG by pressing Esc when the Virtual BUG is selected, and restart the Virtual BUG. You should see the global greeting on the LCD screen.
				</p>
				<h2> <span class="mw-headline" id="Concepts"> Concepts </span></h2>
				<ol><li> We use an OSGi utility class called the ServiceTracker so that our code runs when and if the services we need are available.  When the Activator creates the service, it tells the OSGi runtime which services we are interested in.  This information is actually contained in the ServiceTracker implementation (<tt>initServices()</tt>).
				</li><li> The Status Bar is a shared resource, so we must interact with it in such a way that we do not overwhelm other programs.  The <tt>IStatusBar.aquireRegion</tt> method is the way in which we do this.  The <tt>IStatusBar</tt> implementation manages its resources and will give us what we ask for if it is available.  Be sure to release the region when your application stops so that it is free for use by other bundles.

				</li></ol>

				<!-- 
				NewPP limit report
				Preprocessor node count: 24/1000000
				Post-expand include size: 0/2097152 bytes
				Template argument size: 0/2097152 bytes
				Expensive parser function count: 0/100
				-->

				<!-- Saved in parser cache with key wiki:pcache:idhash:146-0!1!0!!en!2!printable=1 and timestamp 20100924182752 -->
				<div class="printfooter">
				Retrieved from "<a href="http://wiki.buglabs.net/index.php/Tutorial:Create_an_App_That_Consumes_a_Web_Service">http://wiki.buglabs.net/index.php/Tutorial:Create_an_App_That_Consumes_a_Web_Service</a>"</div>
								<!-- /bodytext -->

				<!-- ########### END OF INSERTED CONTENT ########## -->

				<div class="visualClear"></div>
			</div><!-- /bodyContent -->
		</div><!-- /content -->
	</body>
</html>
